// Generated by Create API
// https://github.com/CreateAPI/CreateAPI

import Foundation
import Get
import HTTPHeaders
import URLQueryEncoder

extension Paths.User {
    public var codespaces: Codespaces {
        Codespaces(path: path + "/codespaces")
    }

    public struct Codespaces {
        /// Path: `/user/codespaces`
        public let path: String

        /// List codespaces for the authenticated user
        ///
        /// Lists the authenticated user's codespaces.
        /// 
        /// You must authenticate using an access token with the `codespace` scope to use this endpoint.
        /// 
        /// GitHub Apps must have read access to the `codespaces` repository permission to use this endpoint.
        ///
        /// [API method documentation](https://docs.github.com/rest/reference/codespaces#list-codespaces-for-the-authenticated-user)
        public func get(parameters: GetParameters? = nil) -> Request<GetResponse> {
            Request(method: "GET", url: path, query: parameters?.asQuery, id: "codespaces/list-for-authenticated-user")
        }

        public struct GetResponse: Decodable {
            public var totalCount: Int
            public var codespaces: [GitHubAPI.Codespace]

            public init(totalCount: Int, codespaces: [GitHubAPI.Codespace]) {
                self.totalCount = totalCount
                self.codespaces = codespaces
            }

            public init(from decoder: Decoder) throws {
                let values = try decoder.container(keyedBy: StringCodingKey.self)
                self.totalCount = try values.decode(Int.self, forKey: "total_count")
                self.codespaces = try values.decode([GitHubAPI.Codespace].self, forKey: "codespaces")
            }
        }

        public struct GetParameters {
            public var perPage: Int?
            public var page: Int?
            public var repositoryID: Int?

            public init(perPage: Int? = nil, page: Int? = nil, repositoryID: Int? = nil) {
                self.perPage = perPage
                self.page = page
                self.repositoryID = repositoryID
            }

            public var asQuery: [(String, String?)] {
                let encoder = URLQueryEncoder()
                encoder.encode(perPage, forKey: "per_page")
                encoder.encode(page, forKey: "page")
                encoder.encode(repositoryID, forKey: "repository_id")
                return encoder.items
            }
        }

        /// Create a codespace for the authenticated user
        ///
        /// Creates a new codespace, owned by the authenticated user.
        /// 
        /// This endpoint requires either a `repository_id` OR a `pull_request` but not both.
        /// 
        /// You must authenticate using an access token with the `codespace` scope to use this endpoint.
        /// 
        /// GitHub Apps must have write access to the `codespaces` repository permission to use this endpoint.
        ///
        /// [API method documentation](https://docs.github.com/rest/reference/codespaces#create-a-codespace-for-the-authenticated-user)
        public func post(_ body: PostRequest) -> Request<GitHubAPI.Codespace> {
            Request(method: "POST", url: path, body: body, id: "codespaces/create-for-authenticated-user")
        }

        public enum PostRequest: Encodable {
            case a(A)
            case b(B)

            public struct A: Encodable {
                /// Repository id for this codespace
                public var repositoryID: Int
                /// Git ref (typically a branch name) for this codespace
                public var ref: String?
                /// Location for this codespace. Assigned by IP if not provided
                public var location: String?
                /// IP for location auto-detection when proxying a request
                public var clientIp: String?
                /// Machine type to use for this codespace
                public var machine: String?
                /// Path to devcontainer.json config to use for this codespace
                public var devcontainerPath: String?
                /// Whether to authorize requested permissions from devcontainer.json
                public var isMultiRepoPermissionsOptOut: Bool?
                /// Working directory for this codespace
                public var workingDirectory: String?
                /// Time in minutes before codespace stops from inactivity
                public var idleTimeoutMinutes: Int?
                /// Display name for this codespace
                public var displayName: String?
                /// Duration in minutes after codespace has gone idle in which it will be deleted. Must be integer minutes between 0 and 43200 (30 days).
                public var retentionPeriodMinutes: Int?

                public init(repositoryID: Int, ref: String? = nil, location: String? = nil, clientIp: String? = nil, machine: String? = nil, devcontainerPath: String? = nil, isMultiRepoPermissionsOptOut: Bool? = nil, workingDirectory: String? = nil, idleTimeoutMinutes: Int? = nil, displayName: String? = nil, retentionPeriodMinutes: Int? = nil) {
                    self.repositoryID = repositoryID
                    self.ref = ref
                    self.location = location
                    self.clientIp = clientIp
                    self.machine = machine
                    self.devcontainerPath = devcontainerPath
                    self.isMultiRepoPermissionsOptOut = isMultiRepoPermissionsOptOut
                    self.workingDirectory = workingDirectory
                    self.idleTimeoutMinutes = idleTimeoutMinutes
                    self.displayName = displayName
                    self.retentionPeriodMinutes = retentionPeriodMinutes
                }

                public func encode(to encoder: Encoder) throws {
                    var values = encoder.container(keyedBy: StringCodingKey.self)
                    try values.encode(repositoryID, forKey: "repository_id")
                    try values.encodeIfPresent(ref, forKey: "ref")
                    try values.encodeIfPresent(location, forKey: "location")
                    try values.encodeIfPresent(clientIp, forKey: "client_ip")
                    try values.encodeIfPresent(machine, forKey: "machine")
                    try values.encodeIfPresent(devcontainerPath, forKey: "devcontainer_path")
                    try values.encodeIfPresent(isMultiRepoPermissionsOptOut, forKey: "multi_repo_permissions_opt_out")
                    try values.encodeIfPresent(workingDirectory, forKey: "working_directory")
                    try values.encodeIfPresent(idleTimeoutMinutes, forKey: "idle_timeout_minutes")
                    try values.encodeIfPresent(displayName, forKey: "display_name")
                    try values.encodeIfPresent(retentionPeriodMinutes, forKey: "retention_period_minutes")
                }
            }

            public struct B: Encodable {
                /// Pull request number for this codespace
                public var pullRequest: PullRequest
                /// Location for this codespace. Assigned by IP if not provided
                public var location: String?
                /// Machine type to use for this codespace
                public var machine: String?
                /// Path to devcontainer.json config to use for this codespace
                public var devcontainerPath: String?
                /// Working directory for this codespace
                public var workingDirectory: String?
                /// Time in minutes before codespace stops from inactivity
                public var idleTimeoutMinutes: Int?

                /// Pull request number for this codespace
                public struct PullRequest: Encodable {
                    /// Pull request number
                    public var pullRequestNumber: Int
                    /// Repository id for this codespace
                    public var repositoryID: Int

                    public init(pullRequestNumber: Int, repositoryID: Int) {
                        self.pullRequestNumber = pullRequestNumber
                        self.repositoryID = repositoryID
                    }

                    public func encode(to encoder: Encoder) throws {
                        var values = encoder.container(keyedBy: StringCodingKey.self)
                        try values.encode(pullRequestNumber, forKey: "pull_request_number")
                        try values.encode(repositoryID, forKey: "repository_id")
                    }
                }

                public init(pullRequest: PullRequest, location: String? = nil, machine: String? = nil, devcontainerPath: String? = nil, workingDirectory: String? = nil, idleTimeoutMinutes: Int? = nil) {
                    self.pullRequest = pullRequest
                    self.location = location
                    self.machine = machine
                    self.devcontainerPath = devcontainerPath
                    self.workingDirectory = workingDirectory
                    self.idleTimeoutMinutes = idleTimeoutMinutes
                }

                public func encode(to encoder: Encoder) throws {
                    var values = encoder.container(keyedBy: StringCodingKey.self)
                    try values.encode(pullRequest, forKey: "pull_request")
                    try values.encodeIfPresent(location, forKey: "location")
                    try values.encodeIfPresent(machine, forKey: "machine")
                    try values.encodeIfPresent(devcontainerPath, forKey: "devcontainer_path")
                    try values.encodeIfPresent(workingDirectory, forKey: "working_directory")
                    try values.encodeIfPresent(idleTimeoutMinutes, forKey: "idle_timeout_minutes")
                }
            }

            public func encode(to encoder: Encoder) throws {
                var container = encoder.singleValueContainer()
                switch self {
                case .a(let value): try container.encode(value)
                case .b(let value): try container.encode(value)
                }
            }
        }
    }
}
